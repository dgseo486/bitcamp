<!DOCTYPE html>
<html>
<head>
<meta charset='UTF-8'>
<title>게시물 보기</title>
</head>
<body>
	<div id='header'>
		user01 <a href='/java-project/app/auth/logout'>로그아웃</a>
	</div>

	<h1 class="detail-view">게시물 보기</h1>
	<h1 class="input-view">새 게시글</h1>
	<form>
		<table border='1'>
			<tbody>
				<tr class="detail-view"><th>번호</th><td>
				<input id='fNo' type='text' readonly></td></tr>
				<tr><th>제목</th>
					<td><input id='fTitle' type='text'></td></tr>
				<tr><th>내용</th>
					<td><textarea id='fContent' rows='10' cols='60'></textarea></td></tr>
				<tr class="detail-view"><th>등록일</th>
					<td><input id='fCreatedDate' type='text' readonly></td></tr>
			</tbody>
		</table>
		<p>
			<a href='list.html'>목록</a>
			<button id="addBtn" type="button" class="input-view">등록</button>
			<button id="resetBtn" type="reset" class="input-view">초기화</button>
			<button id="updBtn" type="button" class="detail-view">변경</button>
			<button id="delBtn" type="button" class="detail-view">삭제</button>
		</p>
	</form>
	
	<script>
    var fNo = document.querySelector("#fNo"), 
    //fTitle = document.querySelector("#fTitle"),
    fContent = document.querySelector("#fContent"),
    fCreatedDate = document.querySelector("#fCreatedDate");
    
    if(location.href.split("?").length > 1){
    	   var tags = document.querySelectorAll(".input-view");
    	    for(var tag of tags){
    	        tag.style.display = "none";
    	    }
    
    var no = location.href.split("?")[1].split("=")[1];

    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = () => {
        if(xhr.readyState == 4){
            if(xhr.status == 200){
                var data = JSON.parse(xhr.responseText);
                fNo.value = data.no;
                fTitle.value = data.title;
                fContent.value = data.content;
                fCreatedDate.value = data.createdDate;
            }
        }
    };
        xhr.open("GET", "../../json/board/" + no, true);
        xhr.send();
        
        document.querySelector("#updBtn").onclick = () => {
        	var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = () => {
                if(xhr.readyState == 4){
                    if(xhr.status == 200){
                        location.href = "list.html";
                    } else {
                        window.alert("변경 실패!");
                    }
                }
            };
            xhr.open("POST", "../../json/board/update", true);
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xhr.send("title=" + encodeURIComponent(fTitle.value) + 
            		"&content=" + encodeURIComponent(fContent.value) +
            		"&no=" + fNo.value);
        };
        
        document.querySelector("#delBtn").onclick = () => {
        	if(window.confirm("삭제하시겠습니까?") == false)
        		return;
        	
        	var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = () => {
                if(xhr.readyState == 4){
                    if(xhr.status == 200){
                        location.href = "list.html";
                    } else {
                        window.alert("삭제 실패!");
                    }
                }
            };
            xhr.open("GET", "../../json/board/delete?no=" + no, true);
            xhr.send();
        };
        
} else {
	var tags = document.querySelectorAll(".detail-view");
	for(var tag of tags){
		tag.style.display = "none";
	}
	
	document.querySelector('#addBtn').onclick = () => {
		var xhr = new XMLHttpRequest();
	    xhr.onreadystatechange = () => {
	        if(xhr.readyState == 4){
	            if(xhr.status == 201){
	            	location.href = "list.html";
	            } else {
	            	window.alert("등록 실패!");
	            }
	        }
	    };
	    xhr.open("POST", "../../json/board/add", true);
	    xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
	    xhr.send("title=" + encodeURIComponent(fTitle.value) + "&content=" + encodeURIComponent(fContent.value)); 
	};
}
</script>
</body>
</html>